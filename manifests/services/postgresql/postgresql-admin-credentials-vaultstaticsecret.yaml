---
# VaultStaticSecret для синхронизации PostgreSQL admin credentials из Vault
# Использование:
#   1. Убедитесь, что секреты сохранены в Vault по пути secret/postgresql/admin
#   2. Убедитесь, что Vault Secrets Operator установлен и настроен
#   3. Примените манифест: kubectl apply -f manifests/services/postgresql/postgresql-admin-credentials-vaultstaticsecret.yaml
#   4. Проверьте синхронизацию: kubectl get vaultstaticsecret -n postgresql
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: postgresql-admin-credentials
  namespace: postgresql
  labels:
    app: postgresql
    component: credentials
spec:
  # Ссылка на VaultAuth в namespace vault-secrets-operator
  vaultAuthRef: vault-secrets-operator/default
  # Mount path для KV secrets engine
  mount: secret
  # Тип secrets engine (kv-v2)
  type: kv-v2
  # Путь к секрету в Vault
  path: postgresql/admin
  # Интервал обновления секрета
  refreshAfter: 60s
  # Настройки destination Secret
  destination:
    name: postgresql-admin-credentials
    create: true
