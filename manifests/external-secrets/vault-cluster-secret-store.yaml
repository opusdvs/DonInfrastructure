---
# ClusterSecretStore для подключения External Secrets Operator к Vault
# Использование:
# 1. Убедитесь, что External Secrets Operator установлен и CRD созданы:
#    kubectl get crd | grep external-secrets
#    Если CRD не установлены, установите External Secrets Operator (см. README.md раздел 5)
# 2. Убедитесь, что Vault установлен и разблокирован
# 3. Настройте Kubernetes auth в Vault (см. инструкцию по настройке Kubernetes auth)
# 4. Примените манифест: kubectl apply -f manifests/external-secrets/vault-cluster-secret-store.yaml

apiVersion: external-secrets.io/v1
kind: ClusterSecretStore
metadata:
  name: vault
spec:
  provider:
    vault:
      # Адрес Vault сервера
      server: "http://vault.vault.svc.cluster.local:8200"
      # Путь к секретам (версия KV v2)
      version: "v2"
      # Аутентификация через Kubernetes ServiceAccount
      auth:
        kubernetes:
          # Mount path для Kubernetes auth в Vault
          mountPath: "kubernetes"
          # Роль в Vault для External Secrets Operator
          role: "external-secrets-operator"
          # ServiceAccount для аутентификации
          serviceAccountRef:
            name: external-secrets
            namespace: external-secrets-system
