---
# VaultStaticSecret для Docker Registry credentials в dev кластере (imagePullSecrets для микросервисов)
# Синхронизирует секрет из Vault в Kubernetes Secret типа kubernetes.io/dockerconfigjson
#
# Vault путь: secret/dev/docker-registry
# Ключ в Vault: .dockerconfigjson (значение — JSON для auths, см. README Шаг 10.1)
#
# Kubernetes Secret: registry-docker-registry (namespace: donweather)
# Использование в Deployment: imagePullSecrets: [{ name: registry-docker-registry }]
#
# Для другого namespace скопируйте манифест и измените metadata.namespace.
#
# Применение (в dev кластере):
#   export KUBECONFIG=$HOME/kubeconfig-dev-cluster.yaml
#   kubectl apply -f manifests/dev/docker-registry/registry-docker-registry-vaultstaticsecret.yaml
#
# Проверка:
#   kubectl get vaultstaticsecret registry-docker-registry -n donweather
#   kubectl get secret registry-docker-registry -n donweather
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: registry-docker-registry
  namespace: donweather
  labels:
    app: docker-registry
    component: image-pull
spec:
  vaultAuthRef: vault-secrets-operator/default
  mount: secret
  type: kv-v2
  path: dev/docker-registry
  refreshAfter: 60s
  destination:
    name: registry-docker-registry
    create: true
    type: kubernetes.io/dockerconfigjson
