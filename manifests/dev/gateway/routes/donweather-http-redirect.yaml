---
# HTTPRoute для редиректа HTTP на HTTPS для DonWeather API
# Перенаправляет все HTTP запросы на HTTPS версию
#
# Важно: В HTTPRoute с фильтром RequestRedirect НЕ указывается backendRefs,
# потому что запрос перенаправляется на уровне Gateway, а не проксируется к сервису.
# Сервис DonWeather API указан в отдельном HTTPRoute на HTTPS listener.
#
# Примечание: cert-manager автоматически создаст свой HTTPRoute для
# /.well-known/acme-challenge/ на HTTP listener, который будет иметь
# приоритет над этим правилом благодаря более специфичному пути
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: donweather-http-to-https-redirect
  namespace: donweather
spec:
  hostnames:
    - "api.donweather.dev.buildbyte.ru"
  parentRefs:
    - name: dev-gateway
      namespace: default
      sectionName: http  # HTTP listener для редиректа
  rules:
    # Редирект всех HTTP запросов на HTTPS
    - matches:
        - path:
            type: PathPrefix
            value: /
      filters:
        - type: RequestRedirect
          requestRedirect:
            scheme: https
            statusCode: 301
