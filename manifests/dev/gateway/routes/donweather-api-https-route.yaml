---
# HTTPRoute для DonWeather API на HTTPS listener
# Маршрутизирует запросы по пути в URL к API сервису
apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: donweather-api
  namespace: donweather  # Измените namespace, если приложение установлено в другом namespace
spec:
  hostnames:
    - "api.donweather.dev.buildbyte.ru"
  parentRefs:
    - name: dev-gateway
      namespace: default
      sectionName: https-donweather-api  # HTTPS listener для DonWeather API
  rules:
    # Маршрутизация запросов к микросервису weather
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1/weather
      backendRefs:
        - name: donweather-ms-weather-dev
          port: 8080  # Измените порт, если микросервис использует другой порт
          weight: 1

    # Маршрутизация запросов к микросервису georesolve
    - matches:
        - path:
            type: PathPrefix
            value: /api/v1/georesolve
      backendRefs:
        - name: donweather-ms-georesolve-dev
          port: 8080  # Измените порт, если микросервис использует другой порт
          weight: 1

    # Альтернативные пути (раскомментируйте, если нужны):
    #
    # - matches:
    #     - path:
    #         type: PathPrefix
    #         value: /weather
    #   backendRefs:
    #     - name: donweather-ms-weather-dev
    #       port: 8080
    #       weight: 1
    #
    # - matches:
    #     - path:
    #         type: PathPrefix
    #         value: /georesolve
    #   backendRefs:
    #     - name: donweather-ms-georesolve-dev
    #       port: 8080
    #       weight: 1
