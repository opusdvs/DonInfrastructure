---
# VaultStaticSecret для синхронизации PostgreSQL admin credentials из Vault
#
# Секрет в Vault должен содержать следующие ключи:
#   - postgres_password: пароль для пользователя postgres (admin)
#   - replication_password: пароль для пользователя репликации
#
# Использование:
#   1. Сохраните секреты в Vault:
#      vault kv put secret/postgresql/admin \
#        postgres_password='<ПАРОЛЬ_POSTGRES>' \
#        replication_password='<ПАРОЛЬ_РЕПЛИКАЦИИ>'
#   2. Убедитесь, что Vault Secrets Operator установлен и настроен
#   3. Примените манифест: kubectl apply -f service/manifests/postgresql/postgresql-admin-credentials-vaultstaticsecret.yaml
#   4. Проверьте синхронизацию: kubectl get vaultstaticsecret -n postgresql
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: postgresql-admin-credentials
  namespace: postgresql
  labels:
    app: postgresql
    component: credentials
spec:
  # Ссылка на VaultAuth в namespace vault-secrets-operator
  vaultAuthRef: vault-secrets-operator/default
  # Mount path для KV secrets engine
  mount: secret
  # Тип secrets engine (kv-v2)
  type: kv-v2
  # Путь к секрету в Vault
  path: postgresql/admin
  # Интервал обновления секрета
  refreshAfter: 60s
  # Настройки destination Secret
  destination:
    name: postgresql-admin-credentials
    create: true
