---
# VaultStaticSecret для OIDC клиента Grafana
# Синхронизирует секрет из Vault в Kubernetes Secret
#
# Vault путь: secret/grafana/oidc
# Kubernetes Secret: grafana-oidc-secret (namespace: kube-prometheus-stack)
#
# Использование:
#   kubectl apply -f service/manifests/grafana/grafana-oidc-vaultstaticsecret.yaml
#
# Проверка:
#   kubectl get secret grafana-oidc-secret -n kube-prometheus-stack -o yaml
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: grafana-oidc-credentials
  namespace: kube-prometheus-stack
  labels:
    app: grafana
    component: oidc-credentials
spec:
  # Ссылка на VaultAuth в namespace vault-secrets-operator
  vaultAuthRef: vault-secrets-operator/default
  
  # Путь к секретному движку KV v2
  mount: secret
  type: kv-v2
  
  # Путь к секрету внутри движка (без префикса mount)
  path: grafana/oidc
  
  # Интервал обновления секрета
  refreshAfter: 60s
  
  # Целевой Kubernetes Secret
  destination:
    name: grafana-oidc-secret
    create: true
