---
# VaultStaticSecret для синхронизации Argo CD admin credentials из Vault
#
# Секрет в Vault должен содержать следующие ключи:
#   - password: bcrypt хеш пароля администратора
#
# Для создания bcrypt хеша используйте:
#   htpasswd -nbBC 10 "" <ВАШ_ПАРОЛЬ> | tr -d ':\n' | sed 's/$2y/$2a/'
#
# Использование:
#   1. Сохраните секрет в Vault:
#      vault kv put secret/argocd/admin password='<BCRYPT_ХЕШ>'
#   2. Создайте namespace: kubectl create namespace argocd
#   3. Примените манифест: kubectl apply -f service/manifests/argocd/argocd-admin-credentials-vaultstaticsecret.yaml
#   4. Проверьте синхронизацию: kubectl get vaultstaticsecret -n argocd
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: argocd-admin-credentials
  namespace: argocd
  labels:
    app: argocd
    component: admin-credentials
spec:
  vaultAuthRef: vault-secrets-operator/default
  mount: secret
  type: kv-v2
  path: argocd/admin
  refreshAfter: 60s
  destination:
    name: argocd-initial-admin-secret
    create: true
