# =============================================================================
# Vault Secrets Operator Configuration for Dev Cluster
# =============================================================================
# Этот файл настроен для работы с Vault, развернутым в services кластере.
# Vault Secrets Operator подключается к Vault через внешний адрес:
# https://vault.buildbyte.ru
#
# Важно:
# - defaultVaultConnection отключен, т.к. VaultConnection создается отдельно
# - defaultAuthMethod отключен, т.к. VaultAuth создается отдельно
# - Конфигурация подключения к Vault задается через манифесты:
#   - manifests/dev/vault-secrets-operator/vault-connection.yaml
#   - manifests/dev/vault-secrets-operator/vault-auth.yaml
# =============================================================================

controller:
  replicas: 1
  
  manager:
    image:
      pullPolicy: IfNotPresent
      repository: hashicorp/vault-secrets-operator
      tag: 1.2.0

    logging:
      level: info
      timeEncoding: rfc3339
      stacktraceLevel: panic

    resources:
      limits:
        cpu: 500m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 128Mi

  kubeRbacProxy:
    image:
      pullPolicy: IfNotPresent
      repository: quay.io/brancz/kube-rbac-proxy
      tag: v0.18.1

    resources:
      limits:
        cpu: 500m
        memory: 128Mi
      requests:
        cpu: 5m
        memory: 64Mi

  podSecurityContext:
    runAsNonRoot: true

  securityContext:
    allowPrivilegeEscalation: false

  kubernetesClusterDomain: cluster.local
  terminationGracePeriodSeconds: 120
  preDeleteHookTimeoutSeconds: 120

metricsService:
  ports:
  - name: https
    port: 8443
    protocol: TCP
    targetPort: https
  type: ClusterIP

# VaultConnection создается отдельно через манифест
# manifests/dev/vault-secrets-operator/vault-connection.yaml
defaultVaultConnection:
  enabled: false

# VaultAuth создается отдельно через манифест
# manifests/dev/vault-secrets-operator/vault-auth.yaml
defaultAuthMethod:
  enabled: false

telemetry:
  serviceMonitor:
    enabled: false

hooks:
  resources:
    limits:
      cpu: 500m
      memory: 128Mi
    requests:
      cpu: 10m
      memory: 64Mi
  upgradeCRDs:
    enabled: true
    backoffLimit: 5
    executionTimeout: 30s

csi:
  enabled: false
