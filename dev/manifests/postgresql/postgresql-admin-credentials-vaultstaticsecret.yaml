---
# VaultStaticSecret для синхронизации PostgreSQL admin credentials в dev кластере
#
# Секрет в Vault (в services кластере) по пути secret/postgresql/admin или secret/dev/postgresql/admin.
# Ключи: postgres_password, replication_password.
#
# Использование:
#   1. Секреты в Vault (если ещё не созданы):
#      vault kv put secret/postgresql/admin postgres_password='<ПАРОЛЬ>' replication_password='<ПАРОЛЬ>'
#   2. Namespace postgresql и Vault Secrets Operator в dev должны быть настроены
#   3. kubectl apply -f dev/manifests/postgresql/postgresql-admin-credentials-vaultstaticsecret.yaml
apiVersion: secrets.hashicorp.com/v1beta1
kind: VaultStaticSecret
metadata:
  name: postgresql-admin-credentials
  namespace: postgresql
  labels:
    app: postgresql
    component: credentials
spec:
  vaultAuthRef: vault-secrets-operator/default
  mount: secret
  type: kv-v2
  path: postgresql/admin
  refreshAfter: 60s
  destination:
    name: postgresql-admin-credentials
    create: true
